define("loggingUtils/bi/errors.json",[],function(){return{DATA_PLUGIN_ERROR:{errorCode:111029,severity:"fatal",params:{p1:"store",p2:"path",p3:"value",p4:"stack"}}}}),define("loggingUtils/bi/wixBI",["lodash","coreUtils"],function(e,i){"use strict";function t(e,t,r,u,l){var c=i.urlUtils.joinURL(t,r);u&&(c+="?"+u),e.wixBiSession.sendBeacon&&e.wixBiSession.sendBeacon(c,l),o&&s&&function(e){if(n){var t=window._biCalls;if(t){var r=t.push(i.urlUtils.parseUrl(e));r>a&&t.splice(0,r>>2)}}}(c)}function r(r,n){var o=e.get(r,["serviceTopology","biServerUrl"]);o&&(u.biUrl=o),e.defaults(n,u);var a=!1!==n.useBeacon,l=e.isString(n.queryString)?n.queryString:i.urlUtils.toQueryString(e.defaults(n.params,{ts:function(i,t){var r=s&&"editor"===t.adapter?window.parent.mainLoaded:0;return r=r||i.wixBiSession.initialTimestamp||i.wixBiSession.mainLoaded,e.now()-r}(r,n)}));t(r,n.biUrl,n.adapter,l,a)}var n="undefined"!=typeof window,s=n&&window.queryUtil&&window.queryUtil.isParameterTrue("isEdited"),o=n&&window.queryUtil&&window.queryUtil.isParameterTrue("isqa"),a=1e3;o&&s&&(window._biCalls=[]);var u={biUrl:"//frog.wixpress.com",adapter:"",params:{}};return{report:r}}),define("loggingUtils/logger/newrelic",["lodash"],function(e){"use strict";if(!("undefined"==typeof window||window.queryUtil&&window.queryUtil.isParameterTrue("suppressbi"))){var i=void 0;try{i=window.parent.newrelic}catch(e){i=window.newrelic}if(i){var t=window.performance&&window.performance.now?function(){return Math.round(window.performance.now())}:function(){return 0};return{setCustomAttribute:i.setCustomAttribute.bind(i),addPageAction:function(r,n){var s=t();return n=e.assign({},n,{timeSinceNavigate:s}),i.addPageAction(r,n)},finished:function(){return t()&&this.setCustomAttribute("timeSinceNavigate",t()),i.finished.apply(i,arguments)}}}}return{setCustomAttribute:e.noop,addPageAction:e.noop,finished:e.noop}}),define("loggingUtils/logger/performance",["lodash","loggingUtils/logger/newrelic"],function(e,i){"use strict";function t(){return-1}var r="undefined"!=typeof window&&window.queryUtil;if(!r||r.isParameterTrue("suppressperformance"))return{VERBOSE:"verbose",mark:e.noop,measure:e.noop,start:e.noop,startOnce:e.noop,finish:e.noop,time:function(e,i){return i.apply(this,Array.prototype.slice.call(arguments,2))},getMark:e.noop,getMeasure:e.noop,clearMarks:e.noop,clearMeasures:e.noop,now:e.now,getResourceSize:t};var n=function(){var i=r.getParameterByName("performance"),t=(i?i.toLowerCase():"").split(",");return e.includes(t,"all")?function(){return!0}:function(i){return!i||e.includes(t,i)}}(),s=void 0,o=window.performance;if(o&&o.now)s=o.now.bind(o);else{var a=window.wixBiSession&&window.wixBiSession.initialTimestamp||0;s=function(){return e.now()-a}}var u=r.getParameterByName("debug")&&"force"!==r.getParameterByName("sampleratio")?e.noop:function(t,r){t&&(r=e.defaults({measureName:t.name,startTime:Math.round(t.startTime),duration:Math.round(t.duration)},r),i.addPageAction("measure",r))},l=void 0;if(o&&o.measure){var c=function(i,t){return e.find(o.getEntriesByName(t),{entryType:i})};l={mark:function(e){var i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).category;n(i)&&o.mark(e)},measure:function(e,i,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=r.category,a=r.additionalData,c=r.report;if(n(s))try{o.measure(e,i,t),c&&u(l.getMeasure(e),a)}catch(e){}},getMark:c.bind(this,"mark"),getMeasure:c.bind(this,"measure"),clearMarks:o.clearMarks.bind(o),clearMeasures:o.clearMeasures.bind(o)}}else{var d={domLoading:{name:"domLoading",startTime:0}},g={},f=function i(t,r){r?delete t[r]:(e(t).keys().forEach(i.bind(null,t)),t={})};l={mark:function(e){var i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).category;n(i)&&(d[e]={name:e,startTime:s()})},measure:function(e,i,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=r.category,o=r.additionalData,a=r.report;if(n(s)){var c=l.getMark(i),d=l.getMark(t);if(c&&d){var f={name:e,startTime:c.startTime,duration:d.startTime-c.startTime};isNaN(f.duration)||(g[e]=f,a&&u(f,o))}}},getMark:function(e){return d[e]},getMeasure:function(e){return g[e]},clearMarks:f.bind(this,d),clearMeasures:f.bind(this,g)}}return l.start=function(e,i){l.clearMeasures(e),l.mark(e+" start",i)},l.startOnce=function(e,i){l.getMark(e+" start")||l.start(e,i)},l.finish=function(e,i){var t=e+" start";if(l.getMark(t)){var r=e+" finish";l.mark(r,i),l.measure(e,t,r,i),l.clearMarks(r),l.clearMarks(t)}return l.getMeasure(e)},l.time=function(e,i,t){try{return l.start(e,t),i.apply(this,Array.prototype.slice.call(arguments,4))}finally{l.finish(e,t)}},l.now=s,o&&window.performance.getEntriesByName?l.getResourceSize=function(i){var t=o.getEntriesByName(i);if(t&&t.length){var r=t[0],n=r.transferSize||r.encodedBodySize;if(e.isNumber(n))return n}return-1}:l.getResourceSize=t,l.VERBOSE="verbose",l}),define("loggingUtils/logger/performanceMetrics",[],function(){"use strict";return{MEASURE_NAMES:{4:"main-r started",5:"utils loaded",6:"packages loaded",7:"load data",8:"render",finish:"layout",16:"TPAs"},RENDER_PREPARE:"prepare",RE_RENDER:"reRender",RE_LAYOUT:"reLayout",SAVE:{SAVE_DATA_FIXER:"save-data-fixer"},AUTOSAVE:{PRESAVE_OPERATIONS:"autosave-presave-operations",SEND_AJAX:"autosave-send-ajax",CALC_DIFF:"autosave-calc-diff",LOAD_AJAX:"autosave-load-ajax",LOAD_APPLY:"autosave-load-apply"},DS_INIT:"documentServices initMethod",MOBILE:{CONVERT_PAGE:"convertPage",MERGE_ALL_PAGES:"mergeAllPages"}}}),define("loggingUtils/logger/services/browsingSession",["lodash","coreUtils"],function(e,i){"use strict";function t(){try{return{isNew:!1,ts:parseInt(window.localStorage.getItem(n),10),id:window.localStorage.getItem(s)}}catch(e){return{isNew:!1,ts:null,id:null}}}function r(){var r=!1;return function(){var e=!1,i=Date.now(),r=t();return(isNaN(r.ts)||i-r.ts>o)&&(e=!0),e}()&&(!function(){try{var e=Date.now(),t=i.guidUtils.getGUID();window.localStorage.setItem(n,e),window.localStorage.setItem(s,t)}catch(e){return{ts:null,id:null}}}(),r=!0),function(){try{var e=Date.now();window.localStorage.setItem(n,e)}catch(e){return null}}(),e.assign(t(),{isNew:r})}var n="beatSessionTs",s="beatSessionId",o=18e5;return{SESSION_TS_KEY:n,SESSION_ID_KEY:s,SESSION_TTL_MS:o,get:t,track:r}}),define("loggingUtils/logger/beat",["lodash","loggingUtils/bi/wixBI","coreUtils","loggingUtils/logger/performance","loggingUtils/logger/performanceMetrics","loggingUtils/logger/services/browsingSession","experiment"],function(e,i,t,r,n,s,o){"use strict";function a(i,r,n,s){var o=function(i){return{vuuid:function(){var i=t.cookieUtils.getCookie("_wixUIDX")||"";return i=i.slice(e.lastIndexOf(i,"|")+1),i=i.replace(/^(null-user-id|null)$/g,"")}(),vid:i.getSvSession()||S,dc:function(i){if(e.isString(i)){var t=i.split(".");if(t.length>1)return t[1]}return i}(i.serviceTopology.serverName),vsi:v[i.siteId].viewerSessionId,uuid:i.siteHeader.userId,sid:i.siteId,iss:e.invoke(i,"isClientAfterSSR",!1),msid:i.getMetaSiteId()}}(i),a=function(i,t,r){var n=i.biData,s=n.getTime(),o=b(t,n),a=i.wixBiSession,u={pid:r,pn:n.getPageNumber(),st:function(i){var t=i.rendererModel.siteInfo.documentType,r=e.indexOf(p,t);return-1!==r?r:t}(i),sr:function(){if("undefined"==typeof window)return"";var e=window.screen&&window.screen.width||0,i=window.screen&&window.screen.height||0;return e+"x"+i}(),wr:function(){if("undefined"==typeof window)return"";var e=0,i=0;window.innerWidth?(e=window.innerWidth,i=window.innerHeight):window.document&&(window.document.documentElement&&window.document.documentElement.clientWidth?(e=window.document.documentElement.clientWidth,i=window.document.documentElement.clientHeight):window.document.body&&window.document.body.clientWidth&&(e=window.document.body.clientWidth,i=window.document.body.clientHeight));return e+"x"+i}(),isjp:a.maybeBot?"1":"0",isp:i.isPremiumDomain(),url:function(e){return e.replace(/^http(s)?:\/\/(www\.)?/,"").substring(0,256)}(i.currentUrl.full),ref:window.document.referrer,ts:"start"===t?0:s.loadingTime,tts:"start"===t?0:s.totalLoadingTime,c:e.now(),v:i.baseVersion||"unknown",fis:o.isNew,bsi:o.id};"finish"===t&&"undefined"!=typeof window&&window.santaRenderingError&&(u.ssr_fb=window.santaRenderingError.reason);a&&a.checkVisibility&&(u.ita=a.checkVisibility());return u}(i,n,s),l={et:u(n)};return e.merge({},r,o,a,l)}function u(i){var t=e.indexOf(h,i);return-1!==t?t:i>3?i:-1}function l(e,i){return e&&e.wixBiSession.viewerSessionId&&"preview"!==e.viewMode&&!t.stringUtils.isTrue(e.currentUrl.query.suppressbi)&&-1!==u(i)&&(!E(i)||!function(e){var i=f[e];return f[e]=!0,i}(i))}function c(i,r){return{queryString:function(i){var r=t.urlUtils.toQueryString(e.omit(i,U),!0);return e.reduce(U,function(e,r){return e+"&"+t.urlUtils.toQueryParam(r,i[r],!0)},r)}(r),adapter:I.adapter,biUrl:i.getServiceTopologyProperty("biServerUrl")||I.biUrl}}function d(i,t){var r=i.currentUrl.query.sampleratio;return!(!(e.result(i,"isDebugMode",!1)&&"force"!==r||"none"===r)&&t)||(o.isOpen("vsiCoin",i)&&i.wixBiSession.viewerSessionId?(e.isUndefined(i.wixBiSession.coin)&&(i.wixBiSession.coin=parseInt(i.wixBiSession.viewerSessionId,16)),i.wixBiSession.coin%t==0):0===Math.floor(i.wixBiSession.random*t))}function g(e,s,o){!function(e){v[e.siteId]=v[e.siteId]||{viewerSessionId:e.wixBiSession.viewerSessionId||t.guidUtils.getGUID()}}(e);var u=a(e,_,s,o);if(function(e,i){var t=i.et;w.et=t,e.wixBiSession.et=t}(e,u),l(e,s)&&function(e,t){if(d(e,y[t.et])){var r=c(e,t);i.report(e,r)}}(e,u),e.isViewerMode()){var g=e.viewMode;g="site"===g?"":" "+g,T||(r.measure("main-r started"+g,"domLoading","beat 4",!0),r.measure("utils loaded"+g,"beat 4","beat 5",!0),T="beat 5");var f="beat "+s;r.mark(f);var m=n.MEASURE_NAMES[s]||s;r.measure(m+g,T,f,!0),T=f}}var f=[],m=("undefined"!=typeof window?window:{}).wixBiSession,w=void 0===m?{}:m;w.beat&&w.beat(5);var v={},p=["No Site Type","WixSite","UGC","Template"],h=["No Event Type","start","visible","finish"],S="NO_SV",I={adapter:"bt",biUrl:"http://frog.wix.com/"},_={src:29,evid:3},U=["url","ref"],y={16:20},b=function(e){return"finish"===e?s.track():s.get()},E=function(e){return e>3&&16!==e},T=void 0;return{reportBeatEvent:g,shouldIncludeInSampleRatio:d}}),define("loggingUtils/logger/logger",["lodash","coreUtils","loggingUtils/bi/wixBI","loggingUtils/logger/beat"],function(e,i,t,r){"use strict";function n(t,r){var n={};return(44===t.src||42===t.src&&r)&&(n.visitor_id=r),e.assign(n,{errn:t.errorName,evid:10,sev:function(e){return"string"==typeof e?v[e]:e}(t.severity),cat:g?1:2,iss:1,ut:i.cookieUtils.getCookie("userType")})}function s(t,r,s,o){var l=void 0,c=function(t){h[t.siteId]=h[t.siteId]||t.wixBiSession.viewerSessionId||i.guidUtils.getGUID();var r=t.serviceTopology.serverName?e.head(t.serviceTopology.serverName.split(".")):"",n={site_id:t.siteId,msid:function(i){return e.isFunction(i.getMetaSiteId)?i.getMetaSiteId():i.rendererModel.metaSiteId}(t),majorVer:f,ver:function(e){var i=e.santaBase&&e.santaBase.match(/([\d\.]+)\/?$/);return i&&i[1]||""}(t),server:r,viewMode:t.viewMode};g||(n.vsi=h[t.siteId]);return n}(t);switch(r){case"error":l=function(i,t,r){var s=e.merge({src:44,sev:30,errn:"error_name_not_found"},u(i,w),n(i,r),a(i,t));return t&&t.description&&(s.desc=JSON.stringify(t.description).slice(0,512)),s}(s,o,d(t));break;case"event":l=function(i,t){return e.merge({src:42},u(i,p),a(i,t))}(s,o)}return e.merge(l,c)}function o(e){return"string"==typeof e?encodeURIComponent(e):e}function a(i,t){var r=i.params;return e.isArray(r)?e.pick(t,r):e.isObject(r)?e.mapValues(r,function(e){return o(t[e])}):e.mapValues(t,o)}function u(i,t){return e.transform(i,function(e,i,r){var n=t[r];n&&(e[n]=i)},{})}function l(t,n){return!function(e){return i.stringUtils.isTrue(e.currentUrl.query.suppressbi)}(t)&&!function(e){return!!e&&(e.callCount=e.callCount||0,e.callCount++,e.callLimit&&e.callCount>e.callLimit)}(n)&&function(i,t){if(i.forceBI)return!0;var n=m;return t&&(e.result(i,"isWixSite",!1)&&"wixSiteSampleRatio"in t?n=t.wixSiteSampleRatio:"sampleRatio"in t?n=t.sampleRatio:("errorCode"in t||"editor"===t.endpoint)&&(n=0)),!(n&&n>=1)||r.shouldIncludeInSampleRatio(i,n)}(t,n)}function c(i,r,n){if(i&&e.isObject(r)&&l(i,r)){var o=function(e,i,t){var r=i.reportType||(i.errorCode||i.errc?"error":"event"),n={biUrl:e.serviceTopology.biServerUrl,adapter:i.adapter||i.endpoint||("error"===r?"trg":"ugc-viewer"),params:s(e,r,i,t)};return"useBeacon"in i&&(n.useBeacon=i.useBeacon),n}(i,r,n);t.report(i,o)}}function d(e){return h[e.siteId]||e.wixBiSession&&e.wixBiSession.viewerSessionId}var g="undefined"!=typeof window&&window.queryUtil&&window.queryUtil.isParameterTrue("isEdited"),f="undefined"==typeof window||window.clientSideRender?3:4,m=10,w={errorName:"errn",errorCode:"errc",errc:"errc",src:"src",severity:"sev",sev:"sev",packageName:"errscp"},v={recoverable:10,warning:20,error:30,fatal:40},p={eventId:"evid",evid:"evid",src:"src"},h={};return{reportBI:c,register:function(i,t,r){e.forOwn(r,function(e){e.packageName=i})},reportBeatEvent:r.reportBeatEvent,shouldSendReport:l,getVisitorId:d}}),define("loggingUtils/bi/errors",["loggingUtils/bi/errors.json","lodash","loggingUtils/logger/logger"],function(e,i,t){"use strict";return i.forEach(e,function(e,i){e.errorName=i}),t.register("utils","error",e),e}),define("loggingUtils/logger/services/imageContext",["lodash","loggingUtils/logger/performance"],function(e,i){"use strict";function t(){this._current=null}function r(e,i,t){this._siteData=e,this._pageId=i.pageId,this._events=t,this._interval=0,this._finishCount=1,this._failDetailsBuffer=[],this._status=s.INITIAL,this._reason=o.INITIAL,this._images={total:0,success:0,fail:0,failDetails:[],totalSize:0}}var n={SUCCESS:0,FAIL:1},s={INITIAL:0,PROGRESS:1,FINISHED:2},o={INITIAL:0,SUCCESS_OR_FAIL:1,TIMED_OUT:2,DESTROYED:3},a={},u=/\/(v[0-9.]+\/.+)$/,l=/\/([^\/]+)$/;t.prototype={createImageContext:function(e,i,t,n,s){return this._current=new r(i,{pageId:e},{onProgress:t,onSuccess:n,onFail:s})},getCurrentImageContext:function(){return this._current}},r.prototype={_isFinished:function(){return this._images.total===this._images.success+this._images.fail},_isFinishSuccess:function(){return this._isFinished()&&0===this._images.fail},_checkFinished:function(){this._finishCount<=10&&this._isFinished()&&(this._finish(o.SUCCESS_OR_FAIL),this._isFinishSuccess()?this._events.onSuccess(this):this._events.onFail(this),this._finishCount++)},_startProgress:function(){var e=this,i=1;this._status=s.PROGRESS,this._interval=setInterval(function(){e._flushFailDetailsBuffer(),e._events.onProgress(e,i++),i>10&&e._finish(o.TIMED_OUT)},3e3)},_stopProgress:function(){this._interval&&(clearInterval(this._interval),this._interval=0)},_finish:function(e){this._status=s.FINISHED,this._reason=e,this._failDetailsBuffer.length&&this._flushFailDetailsBuffer(),this._stopProgress()},_onImageStatusChange:function(t,r){if(!(this._status<s.PROGRESS||this._reason>o.SUCCESS_OR_FAIL||r.canceled)){if(t===n.SUCCESS){var a=r.target?i.getResourceSize(r.target.src):0;this._increaseSuccessCount(a)}else{var c=r.target?function(i){if(e.isString(i)){var t=i.match(u);return t||(t=i.match(l))?t[1]:""}return""}(r.target.src):"";this._increaseFailCount(c)}this._checkFinished()}},_increaseSuccessCount:function(e){this._images.success++,this._images.totalSize+=e},_increaseFailCount:function(e){var i=this._siteData.biData.getTime();this._images.fail++,this._failDetailsBuffer.push({d:i.totalLoadingTime,url:e})},_flushFailDetailsBuffer:function(){this._images.failDetails.push(this._failDetailsBuffer),this._failDetailsBuffer=[]},getImages:function(){return this._images},getPageId:function(){return this._pageId},setImages:function(i){var t=function(i,t,r){return e.filter(i,function(e){var i=e.id;return a[i]?r&&!!a[i][t]:(a[i]={},a[i][t]=!0,!0)})}(i,this.getPageId(),this._status===s.INITIAL);return this._images.total+=t.length,this._status===s.INITIAL&&(this._startProgress(),this._checkFinished()),function(i,t,r){e.forEach(i,function(e){e.promise.then(t,r)})}(t,this._onImageStatusChange.bind(this,n.SUCCESS),this._onImageStatusChange.bind(this,n.FAIL)),this},destroy:function(){this._finish(o.DESTROYED)}};var c={_sites:{},get:function(e){return this._sites[e.siteId]=this._sites[e.siteId]||new t}};return{create:function(i,t,r,n,s){return r=r||e.noop,n=n||e.noop,s=s||e.noop,c.get(i).createImageContext(t,i,r.bind(null,i),n.bind(null,i),s.bind(null,i))},getCurrent:function(e){return c.get(e).getCurrentImageContext()}}}),define("loggingUtils/logger/imagesBi",["lodash","loggingUtils/bi/wixBI","coreUtils","loggingUtils/logger/beat","loggingUtils/logger/services/imageContext"],function(e,i,t,r,n){"use strict";function s(i){return JSON.stringify({a:e.take(i,c)})}function o(i,r,n){var s=e.defaults(function(e,i){var r=i.getImages(),n=r.totalSize>=0?Math.round(r.totalSize/1024):"",s=e.biData;return{src:29,d:s.getTime().totalLoadingTime,tn:r.total,sid:e.siteId,msid:e.getMetaSiteId(),pid:i.getPageId(),pn:s.getPageNumber(),vsi:e.wixBiSession.viewerSessionId,vid:t.cookieUtils.getCookie("svSession"),s:n}}(i,r),n);return{adapter:"m",queryString:t.urlUtils.toQueryString(s)}}function a(e,t,r){var n=t.getImages();i.report(e,o(e,t,{evid:11,i:r,sn:n.success,fn:n.fail,fd:s(n.failDetails[r-1])}))}function u(e,t){i.report(e,o(e,t,{evid:12}))}function l(t,r){var n=r.getImages();i.report(t,o(t,r,{evid:13,fn:n.fail,fd:s(e.flatten(n.failDetails))}))}var c=8;return function(e,i){if(function(e){return e.isViewerMode()&&r.shouldIncludeInSampleRatio(e)&&!t.stringUtils.isTrue(e.currentUrl.query.suppressbi)}(e)){var s=e.biData.getPageId(),o=n.getCurrent(e);return o&&o.getPageId()===s||(o&&o.destroy(),o=n.create(e,s,a,u,l)),o=o.setImages(i)}}}),define("loggingUtils",["loggingUtils/bi/errors","loggingUtils/logger/logger","loggingUtils/logger/performance","loggingUtils/logger/newrelic","loggingUtils/logger/imagesBi","loggingUtils/logger/performanceMetrics"],function(e,i,t,r,n,s){"use strict";return{bi:{errors:e},logger:i,performance:t,newrelic:r,imagesBi:n,performanceMetrics:s}});
//# sourceMappingURL=loggingUtils.min.js.map